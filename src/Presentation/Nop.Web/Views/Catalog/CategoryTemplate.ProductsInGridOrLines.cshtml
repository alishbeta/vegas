@model CategoryModel
@using Nop.Core.Domain.Common
@using Nop.Core.Domain.Seo
@inject Nop.Core.IWebHelper webHelper
@inject SeoSettings seoSettings
@inject CommonSettings commonSettings
@{
	Layout = "_ColumnsOne";

	//title
	Html.AddTitleParts(!string.IsNullOrEmpty(Model.MetaTitle) ? Model.MetaTitle : Model.Name);
	//meta
	Html.AddMetaDescriptionParts(Model.MetaDescription);
	Html.AddMetaKeywordParts(Model.MetaKeywords);
	//page class
	Html.AppendPageCssClassParts("html-category-page");

	if (seoSettings.CanonicalUrlsEnabled)
	{
		var categoryUrl = Url.RouteUrl("Category", new { SeName = Model.SeName }, webHelper.CurrentRequestProtocol).ToLowerInvariant();
		Html.AddCanonicalUrlParts(categoryUrl, seoSettings.QueryStringInCanonicalUrlsEnabled);
	}

	var breadcrumbDelimiter = commonSettings.BreadcrumbDelimiter;
}
@*category breadcrumb*@
@section Breadcrumb
	{
	@if (Model.DisplayCategoryBreadcrumb)
	{
		<nav class="breadcrumb-wrap" aria-label="breadcrumb">
			<ol class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
				<li class="breadcrumb-item">
					<a href="@Url.RouteUrl("HomePage")" title="@T("Categories.Breadcrumb.Top")">@T("Categories.Breadcrumb.Top")</a>
				</li>
				@{ int position = 1; }
				@foreach (var cat in Model.CategoryBreadcrumb)
				{
					var isLastCategory = cat.Id == Model.Id;
					<li class="breadcrumb-item @(isLastCategory == true ? "active" : "")" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
						@if (isLastCategory)
						{
							<strong class="current-item" itemprop="name">@cat.Name</strong>
							<span itemprop="item" itemscope itemtype="http://schema.org/Thing">
								<link itemprop="url" href="@Url.RouteUrl("Category", new { SeName = cat.SeName })" />
							</span>
						}
						else
						{
							<a href="@Url.RouteUrl("Category", new { SeName = cat.SeName })" title="@cat.Name" itemprop="item">
								<span itemprop="name">@cat.Name</span>
							</a>
						}
						<meta itemprop="position" content="@position" />
					</li>
					position++;
				}
			</ol>
		</nav>
		@await Component.InvokeAsync("Widget", new { widgetZone = PublicWidgetZones.CategoryDetailsAfterBreadcrumb, additionalData = Model })
	}
}
<div class="cat-content-wrap">
	<div class="title text-center">
		<h3><b>@Model.Name</b></h3>
		<p>
			<small>@Model.Products.Count товаров</small>
		</p>
	</div>
	<div class="filters-wrap">
		<div class="d-inline-block f1">
			<button class="btn btn-outline-secondary btn-sm vg-filter" type="button">
				Показать фильтры
			</button>
		</div>
		<div class="d-inline-block f2 float-right">
			<button class="btn btn-outline-secondary btn-sm vg-filter" type="button">
				По популярности
			</button>
			<button class="btn btn-outline-secondary btn-sm vg-filter" type="button">
				По группам
			</button>
		</div>
	</div>
	<div class="items clearfix">
		<div class="filters-data">
			<div class="inner-wrap f-slider" data-filter-number="1" data-min="0" data-max="300">
				<div class="title">Цена (грн)</div>
				<div class="form-inline">
					<div class="form-group">
						<span>от: </span><input class="form-control" type="text" id="slider-1-a1">
						<span>до: </span><input class="form-control" type="text" id="slider-1-a2">
					</div>
				</div>
				<div id="slider-1-r" class="slider-range"></div>
			</div>
			<div class="inner-wrap f-slider" data-filter-number="2" data-min="0" data-max="200">
				<div class="title">Длина (см)</div>
				<div class="form-inline">
					<div class="form-group">
						<span>от: </span><input class="form-control" type="text" id="slider-2-a1">
						<span>до: </span><input class="form-control" type="text" id="slider-2-a2">
					</div>
				</div>
				<div id="slider-2-r" class="slider-range"></div>
			</div>
			<div class="inner-wrap f-slider" data-filter-number="3" data-min="0" data-max="200">
				<div class="title">Шириина (см)</div>
				<div class="form-inline">
					<div class="form-group">
						<span>от: </span><input class="form-control" type="text" id="slider-3-a1">
						<span>до: </span><input class="form-control" type="text" id="slider-3-a2">
					</div>
				</div>
				<div id="slider-3-r" class="slider-range"></div>
			</div>
			<div class="inner-wrap f-slider" data-filter-number="4" data-min="0" data-max="200">
				<div class="title">Высота (см)</div>
				<div class="form-inline">
					<div class="form-group">
						<span>от: </span><input class="form-control" type="text" id="slider-4-a1">
						<span>до: </span><input class="form-control" type="text" id="slider-4-a2">
					</div>
				</div>
				<div id="slider-4-r" class="slider-range"></div>
			</div>
			<div class="inner-wrap f-slider" data-filter-number="5" data-min="0" data-max="200">
				<div class="title">Максимальная нагрузка (кг)</div>
				<div class="form-inline">
					<div class="form-group">
						<span>от: </span><input class="form-control" type="text" id="slider-5-a1">
						<span>до: </span><input class="form-control" type="text" id="slider-5-a2">
					</div>
				</div>
				<div id="slider-5-r" class="slider-range"></div>
			</div>
			<div class="inner-wrap f-slider" data-filter-number="6" data-min="0" data-max="200">
				<div class="title">Количество пружин</div>
				<div class="form-inline">
					<div class="form-group">
						<span>от: </span><input class="form-control" type="text" id="slider-6-a1">
						<span>до: </span><input class="form-control" type="text" id="slider-6-a2">
					</div>
				</div>
				<div id="slider-6-r" class="slider-range"></div>
			</div>
			<div class="inner-wrap">
				<div class="title">По конструкции</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value="">
					<label class="form-check-label">
						С памятью формы
						<small>400</small>
					</label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value="">
					<label class="form-check-label">
						Пружинные
						<small>400</small>
					</label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value="">
					<label class="form-check-label">
						Безпружинные
						<small>400</small>
					</label>
				</div>
			</div>
			<div class="inner-wrap">
				<div class="title">По размеру</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value="">
					<label class="form-check-label">
						Односпальные
						<small>400</small>
					</label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value="">
					<label class="form-check-label">
						Двуспальные
						<small>400</small>
					</label>
				</div>
			</div>
			<div class="inner-wrap" data-filter-number="6" data-min="0" data-max="200">
				<div class="title">По свойствам</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value="">
					<label class="form-check-label">
						Мягкие
						<small>400</small>
					</label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value="">
					<label class="form-check-label">
						Жесткие
						<small>400</small>
					</label>
				</div>
				<div class="form-check">
					<input class="form-check-input" type="checkbox" value="">
					<label class="form-check-label">
						Средней жесткости
						<small>400</small>
					</label>
				</div>
			</div>
			<div class="inner-wrap text-center">
				<div class="btn-group-vertical">
					<button class="btn btn-lg btn-blue rounded">Применить</button>
					<button class="btn btn-link">Очистить фильтры</button>
				</div>
			</div>
		</div>
		@if (Model.Products.Count > 0)
		{
			<div class="prod-wrap float-right" id="prods">
				@foreach (var product in Model.Products)
				{
					@await Html.PartialAsync("_ProductBox", product)
				}
			</div>
		}

		@{
			var pager = Html.Pager(Model.PagingFilteringContext).QueryParam("pagenumber");
		}
		@if (!pager.IsEmpty())
		{
			<div class="more-wrapp text-center mt-3 mb-3">
				<button class="btn btn-sm btn-blue-white d-none d-md-inline-block" id="loadMore">@T("cat.more")</button>
				<nav class="float-right" aria-label="">
					@pager
				</nav>
			</div>
		}
		@await Component.InvokeAsync("Widget", new { widgetZone = PublicWidgetZones.CategoryDetailsBottom, additionalData = Model })
	</div>
</div>
@await Component.InvokeAsync("RecentlyViewedProductsBlock", new { productThumbPictureSize = 450, preparePriceModel = true })

<script>
	$("#loadMore").on("click", function () {
		var pagesLoaded = parseInt($("#prods div.outer-wrapp").length / 6);
		var currentPageIndex = parseInt($(".active a.page-link").text());
		var pageIndex = pagesLoaded + currentPageIndex - 1;
		$.ajax({
			url: "catalog/getproducts",
			type: "POST",
			dataType: 'json',
			traditional: true,
			data: {
				categoryId: @Model.Id,
				pageIndex: pageIndex
			},
		}).done(function (responce) {
			responce.model.forEach(function (product) {
				var discount = "";
				if (product.ProductPrice.Discount != 0) {
					discount = '<div class="discount">' + + product.ProductPrice.Discount + '%</div>'; 
				}
				var oldPrice = "";
				if (product.ProductPrice.OldPrice != null && product.ProductPrice.OldPrice != "" ) {
					oldPrice = '<div class="price-old">' + + product.ProductPrice.OldPrice + '</div>'; 
				}
				var shortDesc = "";
				if (product.ShortDescription != null) {
					shortDesc = product.ShortDescription;
				}
				var element =
	'<div class="outer-wrapp float-left">' + 
		'<div class="item-wrap">' + 
			'<a href="' + product.SeName + '?productId=' + product.Id + '">' + 
				'<div class="product-img-wrap">' + 
				'<img class="product" src="' + product.DefaultPictureModel.ImageUrl + '" alt="' + product.DefaultPictureModel.AlternateText + '">' + 
					discount +
				'</div>' + 
			'</a>' + 
			'<div class="main-prop-wrap text-left">' + 
				'<a href="' + product.SeName + '?productId=' + product.Id + '">' + 
					'<div class="product-name text-light-c">' + product.Name + '</div>' + 
				'</a>' + 
				'<div class="product-prop">' + shortDesc + '</div>' + 
				'<div class="price-titile">' + '@T("main.product.price")' + '</div>' + 
				'<div class="price-wrap clearfix">' + 
					oldPrice + 
					'<div class="price-new">' + product.ProductPrice.Price + '</div>' + 
				'</div>' + 
			'</div>' + 
		'</div>' + 
		'<div class="item-wrap-full">' + 
			'<i class="favorite_i float-left"></i>' + 
			'<i class="compare_icon float-right"></i>' + 
			'<a href="' + product.SeName + '?productId=' + product.Id + '">' + 
				'<div class="product-img-wrap">' + 
					'<img class="product" src="' + product.DefaultPictureModel.ImageUrl + '" alt="' + product.DefaultPictureModel.AlternateText + '">' + 
					discount +
				'</div>' + 
			'</a>' + 
			'<div class="main-prop-wrap text-left">' + 
				'<a href="' + product.SeName + '?productId=' + product.Id + '">' + 
				'<div class="product-name text-light-c">' + product.Name + '</div>' + 
				'</a>' + 
				'<div class="product-prop">' + shortDesc + '</div>' + 
				'<div class="price-titile">' + '@T("main.product.price")' + '</div>' + 
				'<div class="price-wrap clearfix">' + 
					oldPrice + 
					'<div class="price-new">' + product.ProductPrice.Price + '</div>' + 
				'</div>' + 
			'</div>' + 
			'<div class="sizes-wrap clearfix">' + 
				'<div class="title">Размеры</div>' + 
				'<div class="inner-wrap">' + 
					'<div class="block float-left">' + 
						'<div class="title">Ширина</div>' + 
						'<div class="value">' + product.Width + ' см</div>' + 
					'</div>' + 
					'<div class="block float-left">' + 
						'<div class="title">Длина</div>' + 
						'<div class="value">' + product.Length + ' см</div>' + 
					'</div>' + 
					'<div class="block float-left">' + 
						'<div class="title">Высота</div>' + 
						'<div class="value">' + product.Height + ' см</div>' + 
					'</div>' + 
				'</div>' + 
			'</div>';
				$("#prods").append(element);
			});
		});
	});
</script>
